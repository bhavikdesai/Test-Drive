{"status":{},"product_version":"2.7.1","spec":{"description":"* [Wordpress](http:\/\/@@{HAPROXY.address}@@)","resources":{"client_attrs":{"e3d13dbb-40b3-45c6-a8a7-c7f52e730293":{"y":123.8273285227,"x":164.323964902},"11ba2d6c-02fd-42cf-978e-8fd629b0e8df":{"y":122.9136642614,"x":561.4328750215},"5b40b546-43ae-479a-b4e6-582a0ddaf42f":{"y":122.9136642614,"x":561.4328750215},"7b399982-8e7f-4702-a3df-90814e60869f":{"y":-52.7330692143,"x":366.1473316398},"2e8d105c-5412-47e8-8d78-3b2af0120776":{"y":123.8273285227,"x":164.323964902},"5d004fae-1359-4942-a0f5-0bd417d1207c":{"y":-52.7330692143,"x":366.1473316398},"a6b2f89f-42d7-485c-9a77-07755e5d9d17":{"y":122.9136642614,"x":561.4328750215},"d0d44348-0d8c-4e05-87d0-36dc7dc35a53":{"y":122.9136642614,"x":561.4328750215},"7df0cc1c_deployment":{"y":-52.7330692143,"x":366.1473316398},"48d0f0c2-40ff-4a6e-8108-4d7a7a6338e2":{"y":-52.7330692143,"x":366.1473316398},"4d96f2c3_deployment":{"y":123.8273285227,"x":164.323964902},"d5c3d0c5-b4e5-4427-9f80-d873da20e851":{"y":123.8273285227,"x":164.323964902},"6057790c-8672-42fc-9a54-6d13b1ceea7b":{"y":-52.7330692143,"x":366.1473316398},"23ef31eb-e256-4ddf-b342-fcd0aed6766d":{"y":123.8273285227,"x":164.323964902},"cbc66a9b_deployment":{"y":122.9136642614,"x":561.4328750215}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MYSQL"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"CreateWordPressDB"}],"name":"614e22c6_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"MYSQL"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"CreateWordPressDB","attrs":{"exit_status":[],"script":"#!\/bin\/bash\n\nsudo setenforce 0\nsudo sed -i 's\/permissive\/disabled\/' \/etc\/sysconfig\/selinux\n\n#Create wordpress DB\nmysql -u root -p@@{MYSQL_PASSWORD}@@<<EOF\nCREATE DATABASE wordpress;\nCREATE USER '@@{WP_DB_USER}@@'@'%' IDENTIFIED WITH mysql_native_password BY '@@{WP_DB_PASSWORD}@@';\nGRANT ALL PRIVILEGES ON wordpress.* TO '@@{WP_DB_USER}@@'@'%';\nFLUSH PRIVILEGES;\nEOF","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"55798d8c_runbook","main_task_local_reference":{"kind":"app_task","name":"614e22c6_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MYSQL"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"7d839765_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"631cf0ea_runbook","main_task_local_reference":{"kind":"app_task","name":"7d839765_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MYSQL"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"075e4b33_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"68b3c509_runbook","main_task_local_reference":{"kind":"app_task","name":"075e4b33_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MYSQL"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"c857778e_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"94704c3b_runbook","main_task_local_reference":{"kind":"app_task","name":"c857778e_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MYSQL"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"e9e7d2d3_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"65ac9163_runbook","main_task_local_reference":{"kind":"app_task","name":"e9e7d2d3_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"MYSQL","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"APACHE_PHP"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"ConfigureWordpress"}],"name":"9807fe1b_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"APACHE_PHP"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ConfigureWordpress","attrs":{"exit_status":[],"script":"#!\/bin\/bash\n\n#Get Wordpress installer\nsudo setenforce 0\nsudo sed -i 's\/permissive\/disabled\/' \/etc\/sysconfig\/selinux\nwget http:\/\/wordpress.org\/latest.tar.gz\ntar -xzf latest.tar.gz\nsudo rsync -avP ~\/wordpress\/ \/var\/www\/html\/\nsudo mkdir -p \/var\/www\/html\/wp-content\/uploads\nsudo chown -R apache:apache \/var\/www\/html\/*\n\n#Configure WP\ncd \/var\/www\/html\ncp wp-config-sample.php wp-config.php\nsed -i '\/DB_NAME\/s\/database_name_here\/wordpress\/g' wp-config.php\nsed -i '\/DB_USER\/s\/username_here\/@@{WP_DB_USER}@@\/g' wp-config.php\nsed -i '\/DB_PASSWORD\/s\/password_here\/@@{WP_DB_PASSWORD}@@\/g' wp-config.php\nsed -i '\/DB_HOST\/s\/localhost\/@@{MYSQL.address}@@\/g' wp-config.php\n\nsudo systemctl restart httpd\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"a992bd98_runbook","main_task_local_reference":{"kind":"app_task","name":"9807fe1b_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"APACHE_PHP"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"d3ab8fc3_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"4fd20db5_runbook","main_task_local_reference":{"kind":"app_task","name":"d3ab8fc3_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"APACHE_PHP"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"bfc74f9b_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"e4dbbc0a_runbook","main_task_local_reference":{"kind":"app_task","name":"bfc74f9b_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"APACHE_PHP"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"a5bfd22c_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"0ecebc2f_runbook","main_task_local_reference":{"kind":"app_task","name":"a5bfd22c_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"APACHE_PHP"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"208adab8_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"4e962233_runbook","main_task_local_reference":{"kind":"app_task","name":"208adab8_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[{"kind":"app_service","name":"MYSQL"}],"name":"APACHE_PHP","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAPROXY"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"0ffc772f_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"0b37647d_runbook","main_task_local_reference":{"kind":"app_task","name":"0ffc772f_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAPROXY"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"345bfe30_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"42c025e9_runbook","main_task_local_reference":{"kind":"app_task","name":"345bfe30_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAPROXY"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"8d2423f8_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"4f6625e7_runbook","main_task_local_reference":{"kind":"app_task","name":"8d2423f8_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAPROXY"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"a483ed49_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"ac17cd03_runbook","main_task_local_reference":{"kind":"app_task","name":"a483ed49_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAPROXY"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"9f7ae67d_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"5bb47e63_runbook","main_task_local_reference":{"kind":"app_task","name":"9f7ae67d_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[{"kind":"app_service","name":"APACHE_PHP"}],"name":"HAPROXY","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"AHV_VM","name":"MYSQLAHV","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"300","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"name":true,"resources":{"nic_list":{},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"guest_customization":true,"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"MYSQL","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"84337126-6e22-4cd6-a3f0-7b5b81187e90"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":2,"num_sockets":2,"gpu_list":[],"memory_size_mib":4096,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{CENTOS.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"power_state":"ON","type":"","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"AHV_CENTOS_76","uuid":"a7e10add-be56-4647-a602-b3d51515065f"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"AHV_WORDPRESS","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"300","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"name":true,"resources":{"nic_list":{},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"guest_customization":true,"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"APACHE_PHP@@{calm_array_index}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"84337126-6e22-4cd6-a3f0-7b5b81187e90"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":2,"num_sockets":2,"gpu_list":[],"memory_size_mib":4096,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{CENTOS.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"power_state":"ON","type":"","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"AHV_CENTOS_76","uuid":"a7e10add-be56-4647-a602-b3d51515065f"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]},{"description":"","action_list":[],"type":"AHV_VM","name":"HAPROXYAHV","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"300","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"name":true,"resources":{"nic_list":{},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"guest_customization":true,"disk_list":{}}}},"os_type":"Linux","create_spec":{"name":"HAPROXY","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"84337126-6e22-4cd6-a3f0-7b5b81187e90"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"gpu_list":[],"memory_size_mib":4096,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{CENTOS.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"power_state":"ON","type":"","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"AHV_CENTOS_76","uuid":"a7e10add-be56-4647-a602-b3d51515065f"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]}],"credential_definition_list":[{"username":"centos","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"CENTOS","editables":{"username":true,"secret":true}}],"package_definition_list":[{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"MYSQL"}],"name":"MYSQL_PACKAGE","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"MYSQL_PACKAGE"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"PackageInstallTask"}],"name":"696811b8_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_package","name":"MYSQL_PACKAGE"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"PackageInstallTask","state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nsudo yum install -y \"http:\/\/repo.mysql.com\/mysql-community-release-el7-5.noarch.rpm\"\nsudo yum update -y\nsudo yum install -y sshpass mysql-community-server\n\necho \"[client]\ndefault-character-set=utf8\n\n[mysql]\ndefault-character-set=utf8\n\n[mysqld]\ncollation-server = utf8_unicode_ci\ncharacter-set-server = utf8\ndefault_authentication_plugin = mysql_native_password\" | sudo tee -a \/etc\/my.cnf\n\nsudo systemctl enable mysqld\nsudo systemctl start mysqld\n\n#Fix to obtain temp password and set it to blank\npassword=$(sudo grep -oP 'temporary password(.*): \\K(\\S+)' \/var\/log\/mysqld.log)\nsudo mysqladmin --user=root --password=\"$password\" password aaBB**cc1122\nsudo mysql --user=root --password=aaBB**cc1122 -e \"UNINSTALL COMPONENT 'file:\/\/component_validate_password'\"\nsudo mysqladmin --user=root --password=\"aaBB**cc1122\" password \"\"\n\n# -*- Mysql secure installation\nmysql -u root<<EOF\nALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '@@{MYSQL_PASSWORD}@@';\nDELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1', '::1');\nDELETE FROM mysql.user WHERE User='';\nDELETE FROM mysql.db WHERE Db='test' OR Db='test\\_%';\nFLUSH PRIVILEGES;\nEOF\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"fa139f70_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"696811b8_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"MYSQL_PACKAGE"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"9f5b6937_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"add53bd1_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"9f5b6937_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"APACHE_PHP"}],"name":"APACHE_PHP_PACKAGE","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"APACHE_PHP_PACKAGE"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"PackageInstallTask"}],"name":"27550204_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_package","name":"APACHE_PHP_PACKAGE"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"PackageInstallTask","state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n# -*- Install httpd and php\nsudo setenforce 0\nsudo sed -i 's\/permissive\/disabled\/' \/etc\/sysconfig\/selinux\nsudo yum update -y\nsudo yum -y install epel-release\nsudo rpm -Uvh https:\/\/mirror.webtatic.com\/yum\/el7\/webtatic-release.rpm\nsudo yum -y install http:\/\/rpms.remirepo.net\/enterprise\/remi-release-7.rpm\nsudo yum-config-manager --enable remi-php56\nsudo yum install -y httpd php php-mysql php-fpm php-gd wget unzip\n\n\nsudo systemctl enable httpd","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"124852e5_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"27550204_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"APACHE_PHP_PACKAGE"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"11c3b039_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"afe7faff_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"11c3b039_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"HAPROXY"}],"name":"HAPROXY_PACKAGE","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"HAPROXY_PACKAGE"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[{"kind":"app_task","name":"PackageInstallTask"}],"name":"feefd61c_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_package","name":"HAPROXY_PACKAGE"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"PackageInstallTask","state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nsudo setenforce 0\nsudo sed -i 's\/permissive\/disabled\/' \/etc\/sysconfig\/selinux\n\nport=80\nsudo yum update -y\nsudo yum install -y haproxy\n\necho \"global\n  log 127.0.0.1 local0\n  log 127.0.0.1 local1 notice\n  maxconn 4096\n  quiet\n  user haproxy\n  group haproxy\ndefaults\n  log     global\n  mode    http\n  retries 3\n  timeout client 50s\n  timeout connect 5s\n  timeout server 50s\n  option dontlognull\n  option httplog\n  option redispatch\n  balance  roundrobin\n# Set up application listeners here.\nlisten stats 0.0.0.0:8080\n  mode http\n  log global\n  stats enable\n  stats hide-version\n  stats refresh 30s\n  stats show-node\n  stats uri \/stats\nlisten admin\n  bind 127.0.0.1:22002\n  mode http\n  stats uri \/\nfrontend http\n  maxconn 2000\n  bind 0.0.0.0:80\n  default_backend servers-http\nbackend servers-http\" | sudo tee \/etc\/haproxy\/haproxy.cfg\n\nsudo sed -i 's\/server host-\/#server host-\/g' \/etc\/haproxy\/haproxy.cfg\n\nhosts=$(echo \"@@{APACHE_PHP.address}@@\" | sed 's\/^,\/\/' | sed 's\/,$\/\/' | tr \",\" \"\\n\")\n\n\nfor host in $hosts\ndo\n   echo \"  server host-${host} ${host}:${port} weight 1 maxconn 100 check\" | sudo tee -a \/etc\/haproxy\/haproxy.cfg\ndone\n\nsudo systemctl daemon-reload\nsudo systemctl enable haproxy\nsudo systemctl restart haproxy\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"0f3b1d56_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"feefd61c_dag"},"message_list":[],"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"HAPROXY_PACKAGE"},"retries":"0","description":"","message_list":[],"child_tasks_local_reference_list":[],"name":"b0165015_dag","state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"77f817b9_runbook","state":"ACTIVE","main_task_local_reference":{"kind":"app_task","name":"b0165015_dag"},"message_list":[],"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"AHV_CENTOS_76","version":"","options":{"type":"","name":"CENTOS_76","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-1810.qcow2","version":{"product_version":"","type":"","product_name":""},"architecture":"X86_64","type":""},"description":""},"variable_list":[]},{"description":"","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"ESX_CENTOS_76","version":"","options":{"type":"","name":"CENTOS_76","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-1810.ova","version":{"product_version":"","type":"","product_name":""},"architecture":"X86_64","type":""},"description":""},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"depends_on_list":[],"name":"cbc66a9b_deployment","published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"MYSQL_PACKAGE"}],"substrate_local_reference":{"kind":"app_substrate","name":"MYSQLAHV"},"min_replicas":"1","variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"depends_on_list":[],"name":"7df0cc1c_deployment","editables":{"min_replicas":true,"max_replicas":true},"published_service_local_reference_list":[],"max_replicas":"4","package_local_reference_list":[{"kind":"app_package","name":"APACHE_PHP_PACKAGE"}],"substrate_local_reference":{"kind":"app_substrate","name":"AHV_WORDPRESS"},"min_replicas":"2","variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"depends_on_list":[],"name":"4d96f2c3_deployment","published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"HAPROXY_PACKAGE"}],"substrate_local_reference":{"kind":"app_substrate","name":"HAPROXYAHV"},"min_replicas":"1","variable_list":[],"description":""}],"description":"","action_list":[{"description":"This action will scale out wordpress app vms by given count","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale Out App"},{"kind":"app_task","name":"Configure haproxy"}],"name":"788fce62_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Scale Out App"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Configure haproxy"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"7df0cc1c_deployment"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Scale Out App","attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","type":"SCALING","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAPROXY"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure haproxy","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo setenforce 0\nsudo sed -i 's\/permissive\/disabled\/' \/etc\/sysconfig\/selinux\n\nport=80\n\n\necho \"global\n  log 127.0.0.1 local0\n  log 127.0.0.1 local1 notice\n  maxconn 4096\n  quiet\n  user haproxy\n  group haproxy\ndefaults\n  log     global\n  mode    http\n  retries 3\n  timeout client 50s\n  timeout connect 5s\n  timeout server 50s\n  option dontlognull\n  option httplog\n  option redispatch\n  balance  roundrobin\n# Set up application listeners here.\nlisten stats 0.0.0.0:8080\n  mode http\n  log global\n  stats enable\n  stats hide-version\n  stats refresh 30s\n  stats show-node\n  stats uri \/stats\nlisten admin\n  bind 127.0.0.1:22002\n  mode http\n  stats uri \/\nfrontend http\n  maxconn 2000\n  bind 0.0.0.0:80\n  default_backend servers-http\nbackend servers-http\" | sudo tee \/etc\/haproxy\/haproxy.cfg\n\nsudo sed -i 's\/server host-\/#server host-\/g' \/etc\/haproxy\/haproxy.cfg\n\nhosts=$(echo \"@@{APACHE_PHP.address}@@\" | sed 's\/^,\/\/' | sed 's\/,$\/\/' | tr \",\" \"\\n\")\n\n\nfor host in $hosts\ndo\n   echo \"  server host-${host} ${host}:${port} weight 1 maxconn 100 check\" | sudo tee -a \/etc\/haproxy\/haproxy.cfg\ndone\n\nsudo systemctl daemon-reload\nsudo systemctl enable haproxy\nsudo systemctl restart haproxy\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"8a03e7aa_runbook","main_task_local_reference":{"kind":"app_task","name":"788fce62_dag"},"variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"COUNT","value":"1","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false}]},"name":"ScaleOut"},{"description":"This action will scale in wordpress app vms by given count","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale In App"},{"kind":"app_task","name":"Configure haproxy"}],"name":"51ca4a45_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Scale In App"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Configure haproxy"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"7df0cc1c_deployment"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Scale In App","attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","type":"SCALING","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAPROXY"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Configure haproxy","attrs":{"exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo setenforce 0\nsudo sed -i 's\/permissive\/disabled\/' \/etc\/sysconfig\/selinux\n\nport=80\n\n\necho \"global\n  log 127.0.0.1 local0\n  log 127.0.0.1 local1 notice\n  maxconn 4096\n  quiet\n  user haproxy\n  group haproxy\ndefaults\n  log     global\n  mode    http\n  retries 3\n  timeout client 50s\n  timeout connect 5s\n  timeout server 50s\n  option dontlognull\n  option httplog\n  option redispatch\n  balance  roundrobin\n# Set up application listeners here.\nlisten stats 0.0.0.0:8080\n  mode http\n  log global\n  stats enable\n  stats hide-version\n  stats refresh 30s\n  stats show-node\n  stats uri \/stats\nlisten admin\n  bind 127.0.0.1:22002\n  mode http\n  stats uri \/\nfrontend http\n  maxconn 2000\n  bind 0.0.0.0:80\n  default_backend servers-http\nbackend servers-http\" | sudo tee \/etc\/haproxy\/haproxy.cfg\n\nsudo sed -i 's\/server host-\/#server host-\/g' \/etc\/haproxy\/haproxy.cfg\n\nhosts=$(echo \"@@{APACHE_PHP.address}@@\" | sed 's\/^,\/\/' | sed 's\/,$\/\/' | tr \",\" \"\\n\")\n\n\nfor host in $hosts\ndo\n   echo \"  server host-${host} ${host}:${port} weight 1 maxconn 100 check\" | sudo tee -a \/etc\/haproxy\/haproxy.cfg\ndone\n\nsudo systemctl daemon-reload\nsudo systemctl enable haproxy\nsudo systemctl restart haproxy\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"CENTOS"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"5f546660_runbook","main_task_local_reference":{"kind":"app_task","name":"51ca4a45_dag"},"variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"COUNT","value":"1","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false}]},"name":"ScaleIn"}],"name":"Nutanix","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"SECRET","name":"MYSQL_PASSWORD","value":"","label":"","attrs":{"is_secret_modified":false,"secret_reference":{},"type":""},"editables":{"value":true},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"WP_DB_USER","value":"wordpress","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"SECRET","name":"WP_DB_PASSWORD","value":"","label":"","attrs":{"is_secret_modified":false,"secret_reference":{},"type":""},"editables":{"value":true},"is_hidden":false}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"CENTOS"},"type":"USER"},"name":"Wordpress"},"api_version":"3.0","metadata":{"last_update_time":"1583522119916791","kind":"blueprint","spec_version":5,"creation_time":"1583521043764561","categories":{"AppFamily":"DevOps"},"name":"Wordpress"}}